{% extends 'profil/base.html' %} {% block content %}
<style>
    .chart-nav {
        margin-bottom: 20px;
    }
    .chart-nav-button {
        padding: 10px 15px;
        border: 1px solid #ccc;
        background-color: #f0f0f0;
        cursor: pointer;
        margin-right: 5px;
    }
    .chart-nav-button.active {
        background-color: #007bff;
        color: white;
        border-color: #007bff;
    }
    .chart-container {
        width: 80%;
        max-width: 900px;
        margin: auto;
    }
</style>

<h2>Data Statistik Desa</h2>

<div class="chart-nav">
    {% for kategori in kategori_list %}
        <button class="chart-nav-button" data-kategori="{{ kategori }}">{{ kategori }}</button>
    {% endfor %}
</div>

<div class="chart-container">
    <canvas id="myChart"></canvas>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const DATA_URL = "{% url 'statistik:get_data_statistik' %}";
    
    const ctx = document.getElementById('myChart').getContext('2d');
    let myChart; 

    async function updateChart(kategori = null) {
        
        let url = DATA_URL;
        if (kategori) {
            url += `?kategori=${encodeURIComponent(kategori)}`;
        }
        
        try {
            const response = await fetch(url);
            const result = await response.json();
            
            const chartData = {
                labels: result.labels,
                datasets: [{
                    label: kategori || 'Data Statistik', 
                    data: result.data,
                    backgroundColor: [ 
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            };
            if (myChart) {
                myChart.data = chartData;
                myChart.options.plugins.title.text = `Data ${kategori || 'Statistik'}`;
                myChart.update();
            } else {
                myChart = new Chart(ctx, {
                    type: 'bar', 
                    data: chartData,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: `Data ${kategori || 'Statistik'}`
                            }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }
        } catch (error) {
            console.error('Error fetching data:', error);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const buttons = document.querySelectorAll('.chart-nav-button');
        
        buttons.forEach(button => {
            button.addEventListener('click', () => {
                const kategori = button.dataset.kategori;

                buttons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                updateChart(kategori);
            });
        });

        if (buttons.length > 0) {
            buttons[0].classList.add('active');
            updateChart(buttons[0].dataset.kategori); 
        }
    });
</script>

{% endblock %}
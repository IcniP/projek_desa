{% extends 'profil/base.html' %} {% block content %}
<style>
    h2 {
        text-align: center;
        font-weight: 700;
        margin-bottom: 25px;
        color: #7b0000; /* merah maroon khas pemerintahan */
    }

    .chart-nav {
        margin-bottom: 25px;
        text-align: center;
    }

    .chart-nav-button {
        padding: 10px 18px;
        border: none;
        background-color: #e6e6e6;
        border-radius: 8px;
        cursor: pointer;
        margin-right: 6px;
        font-weight: 600;
        transition: 0.3s;
    }

    .chart-nav-button:hover {
        background-color: #d5d5d5;
    }

    .chart-nav-button.active {
        background-color: #b30000;  
        color: white;
        box-shadow: 0 3px 8px rgba(0,0,0,0.3);
    }

    .chart-box {
        background: #fff;
        padding: 30px;
        border-radius: 15px;
        width: 85%;
        max-width: 900px;
        margin: auto;
        box-shadow: 0 10px 25px rgba(0,0,0,0.12);
    }
</style>

<h2>Data Statistik Desa</h2>

<div class="chart-nav">
    {% for kategori in kategori_list %}
        <button class="chart-nav-button" data-kategori="{{ kategori }}">{{ kategori }}</button>
    {% endfor %}
</div>

<div class="chart-box">
    <canvas id="myChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const DATA_URL = "{% url 'statistik:get_data_statistik' %}";
    
    const ctx = document.getElementById('myChart').getContext('2d');
    let myChart; 

    async function updateChart(kategori = null) {
        
        let url = DATA_URL;
        if (kategori) {
            url += `?kategori=${encodeURIComponent(kategori)}`;
        }
        
        try {
            const response = await fetch(url);
            const result = await response.json();
            
            const chartData = {
                labels: result.labels,
                datasets: [{
                    label: kategori || 'Data Statistik', 
                    data: result.data,
                    backgroundColor: [
                        'rgba(139, 0, 0, 0.4)',
                        'rgba(139, 0, 0, 0.55)',
                        'rgba(139, 0, 0, 0.60)',
                        'rgba(255, 193, 7, 0.45)',
                        'rgba(255, 193, 7, 0.65)',
                        'rgba(255, 193, 7, 0.85)'
                    ],
                    borderColor: [
                        '#7b0000',
                        '#7b0000',
                        '#7b0000',
                        '#ffc107',
                        '#ffc107',
                        '#ffc107'
                    ],
                    borderWidth: 1
                }]
            };
            if (myChart) {
                myChart.data = chartData;
                myChart.options.plugins.title.text = `Data ${kategori || 'Statistik'}`;
                myChart.update();
            } else {
                myChart = new Chart(ctx, {
                    type: 'bar', 
                    data: chartData,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: `Data ${kategori || 'Statistik'}`,
                                font: { size: 18, weight: 'bold' }
                            },
                            tooltip: {
                                backgroundColor: "#ffffff",
                                titleColor: "#000",
                                bodyColor: "#000",
                                borderColor: "#ccc",
                                borderWidth: 1,
                                padding: 10,
                                displayColors: false
                            }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }
        } catch (error) {
            console.error('Error fetching data:', error);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const buttons = document.querySelectorAll('.chart-nav-button');
        
        buttons.forEach(button => {
            button.addEventListener('click', () => {
                const kategori = button.dataset.kategori;

                buttons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                updateChart(kategori);
            });
        });

        if (buttons.length > 0) {
            buttons[0].classList.add('active');
            updateChart(buttons[0].dataset.kategori); 
        }
    });
</script>

{% endblock %}